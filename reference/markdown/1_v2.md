**1. Knowledge Graph Construction（知识图谱构建）** 部分进行完善和细化，对各变量和公式的意义进行更详细的阐释。

---

### **1. Knowledge Graph Construction（知识图谱构建）**（完善版）

本节旨在将原始的、无结构的振动数据转化为一个结构化的、包含丰富物理语义关系的知识图谱。该图谱将特征与故障类型之间的关联进行显式地、量化地表达，为后续的诊断和决策提供可解释的先验知识支撑。

该构建过程分为三个核心步骤：**1.1 特征提取**、**1.2 相关性矩阵计算**和**1.3 图谱构建**。

---

### **1.1 Feature Extraction (特征提取)**

**目的**：从原始振动信号中提取能够表征轴承不同健康状态的多域特征。这些特征构成了知识图谱中最底层的、可观测的证据节点，是构建高层语义关系的基础。

**输入**：
- 原始振动数据集 \( D = \{( \mathbf{x}_i, y_i )\}_{i=1}^{N} \)。
    - \( \mathbf{x}_i \): 第 \( i \) 个样本的原始振动信号序列（一维时间序列）。
    - \( y_i \in \{1, 2, ..., C\} \): 第 \( i \) 个样本对应的故障类别标签，\( C \) 为故障总类别数（如正常、内圈故障、外圈故障等）。
    - \( N \): 样本总数。

**输出**：
- 多域特征矩阵 \( \mathbf{F} \in \mathbb{R}^{N \times D} \)。
    - 该矩阵的每一行 \( \mathbf{f}_i \) 代表一个样本的特征向量。
    - 每一列代表所有样本在某个特定特征上的取值。
    - \( D = 31 \): 特征的总维度（数量）。

**核心公式与详细解释**：
对每个样本信号 \( \mathbf{x}_i \)，我们系统地从三个领域提取共 \( D = 31 \) 个特征，构成其特征向量 \( \mathbf{f}_i \)：

\[
\mathbf{f}_i = [\underbrace{p_1, p_2, \cdots, p_{11}}_{\text{Time-Domain (11)}}, \underbrace{p_{12}, p_{13}, \cdots, p_{23}}_{\text{Frequency-Domain (12)}}, \underbrace{E_1, E_2, E_3, E_4, S_1, S_2, S_3, S_4}_{\text{VMD Features (8)}}]
\]

1.  **时域特征 (Time-Domain Features, 11个)**:
    - **目的**：直接在信号的时间波形上计算统计指标，反映信号的幅值、能量、分布及冲击特性。这些特征对信号的冲击性成分（如故障引发的冲击）非常敏感。
    - **计算**：严格按照论文TABLE I公式计算，包括：
        - **均值 (Mean)**: \( p_1 = \frac{1}{L}\sum_{t=1}^{L} x(t) \)
        - **标准差 (Standard Deviation)**: \( p_2 = \sqrt{\frac{1}{L-1}\sum_{t=1}^{L} (x(t)-p_1)^2} \)
        - **方根幅值 (Square Mean of Square Root)**: \( p_3 = \left( \frac{1}{L}\sum_{t=1}^{L} \sqrt{|x(t)|} \right)^2 \)
        - **均方根 (RMS)**: \( p_4 = \sqrt{\frac{1}{L}\sum_{t=1}^{L} x(t)^2} \)
        - **峰值 (Peak)**: \( p_5 = \max(|x(t)|) \)
        - **偏度 (Skewness)**: \( p_6 = \frac{\frac{1}{L}\sum_{t=1}^{L} (x(t)-p_1)^3}{p_2^3} \)
        - **峭度 (Kurtosis)**: \( p_7 = \frac{\frac{1}{L}\sum_{t=1}^{L} (x(t)-p_1)^4}{p_2^4} \)
        - **波形因子 (Waveform Factor)**: \( p_8 = p_4 / \left( \frac{1}{L}\sum |x(t)| \right) \)
        - **峰值因子 (Peak Factor)**: \( p_9 = p_5 / p_3 \)
        - **脉冲因子 (Impulse Factor)**: \( p_{10} = p_5 / \left( \frac{1}{L}\sum |x(t)| \right) \)
        - **裕度因子 (Crest Factor)**: \( p_{11} = p_5 / p_4 \)

2.  **频域特征 (Frequency-Domain Features, 12个)**:
    - **目的**：将信号通过傅里叶变换（FFT）映射到频域，计算频域谱的统计指标。这些特征反映了信号频率成分的分布和变化，对于识别与特定故障频率相关的成分至关重要。
    - **计算**：严格按照论文TABLE II公式计算，基于幅度谱 \( s(l) \)：
        - **频谱均值 (Spectral Mean)**: \( p_{12} = \frac{1}{L}\sum_{l=1}^{L} s(l) \)
        - **频谱方差 (Spectral Variance)**: \( p_{13} = \frac{1}{L-1}\sum_{l=1}^{L} (s(l)-p_{12})^2 \)
        - **频谱偏度 (Spectral Skewness)**: \( p_{14} = \frac{\sum (s(l)-p_{12})^3}{L \cdot p_{13}^{3/2}} \)
        - **频谱峰度 (Spectral Kurtosis)**: \( p_{15} = \frac{\sum (s(l)-p_{12})^4}{L \cdot p_{13}^2} \)
        - **频率重心 (Frequency Center)**: \( p_{16} = \frac{\sum f_l \cdot s(l)}{\sum s(l)} \)
        - **频率均方根 (Frequency RMS)**: \( p_{17} = \sqrt{\frac{\sum f_l^2 \cdot s(l)}{\sum s(l)}} \)
        - **频率标准差 (Frequency Std)**: \( p_{18} = \sqrt{\frac{\sum (f_l-p_{16})^2 \cdot s(l)}{L}} \)
        - **频率四阶矩 (Frequency 4th Moment)**: \( p_{19} = \sqrt{\frac{\sum f_l^4 \cdot s(l)}{\sum f_l^2 \cdot s(l)}} \)
        - **频率形状因子 (Frequency Shape Factor)**: \( p_{20} = \frac{\sum f_l^2 \cdot s(l)}{\sqrt{\sum s(l) \cdot \sum f_l^4 \cdot s(l)}} \)
        - **频率偏度因子 (Frequency Skew Factor)**: \( p_{21} = p_{18} / p_{16} \)
        - **频率偏度 (Frequency Skewness)**: \( p_{22} = \frac{\sum (f_l-p_{16})^3 \cdot s(l)}{L \cdot p_{18}^3} \)
        - **频率峰度 (Frequency Kurtosis)**: \( p_{23} = \frac{\sum (f_l-p_{16})^4 \cdot s(l)}{L \cdot p_{18}^4} \)

3.  **VMD时频域特征 (VMD Time-Frequency Features, 8个)**:
    - **目的**：利用变分模态分解（VMD）将非平稳、非线性的原始信号自适应地分解为一系列相对平稳的本征模态函数（IMF）。不同故障状态会激发不同频带的模态分量，其能量分布和模态矩阵的奇异值因此具有显著的区分性。
    - **计算**：
        - **VMD能量特征 (4个)**：对信号进行VMD分解得到4个IMF分量后，计算每个分量的能量：
            \[
            E_m = \sum_{t=1}^{L} |C_m(t)|^2 \quad (m=1,2,3,4)
            \]
        - **VMD奇异值特征 (4个)**：将4个IMF分量构成矩阵 \( \mathbf{U} \in \mathbb{R}^{4 \times L} \)，然后进行奇异值分解（SVD）得到奇异值 \( \sigma_1, \sigma_2, \sigma_3, \sigma_4 \)：
            \[
            \mathbf{U} = \mathbf{\Sigma} \mathbf{S} \mathbf{V}^T
            \]
            奇异值反映了模态矩阵的能量分布集中程度，是对能量特征的有效补充。

---

### **1.2 Correlation Matrix Calculation (相关性矩阵计算)**  
**目的**：量化每个特征与每个故障类型的相关性权重 \(w_{ik}\)，作为知识图谱的边权重。**论文采用监督方法，直接使用真实标签计算隶属度**，而非无监督FCM。  

**输入**：特征矩阵 \(\mathbf{F}\) 和故障标签向量 \(\mathbf{y}\)。  
**输出**：相关性权重矩阵 \(\mathcal{W} \in \mathbb{R}^{C \times D}\)，其中 \(w_{ik} \in [0,1]\) 且 \(\sum_k w_{ik} = 1\)。  

**核心公式与修正说明**：  
1. **监督式隶属度矩阵 \(u_{ij}\)**（论文Step 2）：  
   \[
   u_{ij} = 
   \begin{cases} 
   1 & \text{if } y_j = i \quad (\text{样本 } j \text{ 属于故障类别 } i) \\
   0 & \text{otherwise}
   \end{cases}
   \]  
   这确保了隶属度与真实标签严格一致，避免聚类不确定性。

2. **聚类中心 \(v_{ik}\)**（论文公式(4)）：  
   \[
   v_{ik} = \frac{\sum_{j=1}^N u_{ij} \cdot f_{jk}}{\sum_{j=1}^N u_{ij}}
   \]  
   由于 \(u_{ij}\) 是硬隶属度，\(v_{ik}\) 简化为故障类别 \(i\) 下特征 \(k\) 的样本均值。

3. **散布矩阵 \(\sigma_{ik}\)**（论文公式(3)）：  
   \[
   \sigma_{ik} = \sum_{j=1}^N u_{ij} (f_{jk} - v_{ik})^2
   \]  
   \(\sigma_{ik}\) 表示故障类别 \(i\) 中特征 \(k\) 的方差，值越小则特征越重要。

4. **相关性权重 \(w_{ik}\)**（论文公式(2)）：  
   \[
   w_{ik} = \frac{(\sigma_{ik})^{-1/2}}{\sum_{k'=1}^D (\sigma_{ik'})^{-1/2}}
   \]  
   权重与方差倒数成正比，归一化后反映特征对故障的诊断贡献度。

**修正理由**：论文明确使用监督方法（见III-D节），硬隶属度计算更高效且与工程实际一致，而“1.txt”中的FCM会引入无监督偏差。

---


### **1.3 Graph Construction (图谱构建)**

**目的**：将前两步得到的实体（特征、故障）和关系（相关性权重）用图结构进行形式化表示，最终构建成一个可查询、可推理的知识图谱 \( \mathcal{KG} \)。

**输入**：
- 所有特征名称集合 \( \mathcal{F} = \{f_1, f_2, ..., f_D\} \) （对应 `FULL_FEATURE_NAMES`）
- 所有故障类别名称集合 \( \mathcal{D} = \{d_1, d_2, ..., d_C\} \) （对应 `label_names`）
- 特征-故障相关性权重矩阵 \( \mathcal{W} = [w_{ik}]_{C \times D} \)

**输出**：
- 知识图谱 \( \mathcal{KG} = (\mathcal{V}, \mathcal{E}) \)，定义为节点和边的集合，边上附有权重属性。

**构建过程与解释**：
1.  **节点集 (Vertices Set)**:
    \[
    \mathcal{V} = \mathcal{V}_{feature} \cup \mathcal{V}_{fault}
    \]
    - **特征节点 (Feature Nodes)**: \( \mathcal{V}_{feature} = \{f_1, f_2, \cdots, f_D\} \)，每个节点具有属性 `bipartite=0` 和 `type="feature"`。
    - **故障节点 (Fault Nodes)**: \( \mathcal{V}_{fault} = \{d_1, d_2, \cdots, d_C\} \)，每个节点具有属性 `bipartite=1` 和 `type="fault"`。

2.  **边集 (Edges Set)**:
    \[
    \mathcal{E} = \{ (f_k, d_i) \mid w_{ik} > \theta, \forall i=1,...,C; \forall k=1,...,D \}
    \]
    - 在**特征节点 \( f_k \)** 和**故障节点 \( d_i \)** 之间建立一条**无向边**（与代码实现一致）。
    - **边的语义**：表示“**特征 \( f_k \) 与故障 \( d_i \) 存在关联**”。
    - **阈值 \( \theta \)**：为了简化图谱结构，只保留权重大于阈值 \( \theta \)（如0.005）的边，过滤掉弱关联。

3.  **边权重 (Edge Weights)**:
    - 每一条边 \( (f_k, d_i) \) 都被赋予一个权重属性，值等于 \( w_{ik} \)。
    - **权重的语义**：权重 \( w_{ik} \) 量化了关联的强度。权重越大，表示特征 \( f_k \) 对推断故障 \( d_i \) 的贡献越大。

### **知识图谱结构示意图**

*(该示意图应展示一个标准的二分图（Bipartite Graph）结构。左侧一列节点为特征节点 \( f_1, f_2, ..., f_D \)（共31个），右侧一列节点为故障节点 \( d_1, d_2, ..., d_C \)（如4类）。特征节点与故障节点之间的无向边，其粗细直观地与权重 \( w_{ik} \) 的大小成正比。这种可视化方式使得整个图谱中最重要的关联关系一目了然。)*

此知识图谱 \( \mathcal{KG} \) 捕获了领域知识（特征与故障的物理关系），为后续的诊断过程提供了一个结构化、可解释的先验模型。通过将复杂的多域特征与故障类型通过量化权重关联起来，该图谱不仅支持基于规则的推理，也为基于图神经网络的高级诊断方法奠定了基础。